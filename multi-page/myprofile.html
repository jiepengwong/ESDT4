<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <!--bootstrap css-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!--axios-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <!--Vue-->
    <script src="https://unpkg.com/vue@next"></script>
    <!-- Google Auth0 -->
    <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
    <meta name="google-signin-client_id" content="616186403576-ofsdqf0tp3r19t60rmflus3l3h9p25vo.apps.googleusercontent.com">
</head>
<script>
    function checkLogin() {
        // If the login variable is initalised, then we will redirect them to 
        if (localStorage.getItem("id")){
            // redirect them to login page
        }
        else {
            window.location.replace("/ESD_PROJECT/ESDT4/multi-page/index.html");
        }
    }
</script>
<body onload="checkLogin()">
    <div id="app">
        <!-- This is where the NAVBAR IS!! ############## -->
        <navbar></navbar>
        <!-- This is where the NAVBAR ENDS!! ############## -->

        <!--THIS IS WHERE ThE PROFILE IS..################  -->
        <div class="bg-light rounded-3 m-2">
            <div class="fw-light fs-6" style="color:grey; text-align:center">User information</div>
            
            <!-- 1st Row -->
            <!-- {{name}} {{email}} {{mobile}} {{ratings}} -->
            
            <div class="row m-2">
                <div class="col-sm-6">
                    <label for="username" class="form-label" >Name</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="username" aria-describedby="basic-addon3" v-bind:value="id" readonly>
                    </div>
                </div>
            </div>


            <div class="row m-2">
                <div class="col-sm-6">
                    <label for="username" class="form-label" >Name</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="username" aria-describedby="basic-addon3" v-bind:value="name" readonly>
                    </div>
                </div>
            </div>

            <!-- 2nd Row  -->
            <div class="row m-2 mb-4">
                <div class="col-sm-6">
                    <label for="birthday" class="form-label">Email</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="birthday" aria-describedby="basic-addon3" v-bind:value="email" readonly>
                    </div>
                </div>
            </div>

            <!-- 3rd Row -->
            <div class="row m-2 mb-4">
                <div class="col-sm-6">
                    <label for="birthday" class="form-label">Ratings</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="birthday" aria-describedby="basic-addon3" v-bind:value="ratings" readonly>
                    </div>
                </div>
            </div>

            <!-- 4th Row -->
            <div class="row m-2 mb-4">
                <div class="col-sm-6">
                    <label for="birthday" class="form-label">Number</label>
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="basic-addon3">+65</span>
                        <input type="text" class="form-control" id="birthday" aria-describedby="basic-addon3" v-bind:value="mobile" readonly>
                    </div>
                    <a href ="Insertmobile.php">Update my number</a>
                </div>
            </div>

        </div>
    </div>
</body>

<script src="./narbar.js"></script>
<script>
    
    
    // VUE PORTION GOES IN HERE #################################################################################
    const app = Vue.createApp({
        data() {
            return {
                // THE JSON DATA IS TAKEN FROM THE Google Chrome 
                jsondata: localStorage.login,
                id: localStorage.id,
                name: "",
                mobile: "",
                email: "",
                ratings: "",
            }
        },
        computed : {
        
        },
        
        methods: {
        
            
        },
        computed: {

        },
        async mounted () {
            try{
                var getItemUrl = "http://localhost:5000/profile/" + String(localStorage.id)
                console.log(getItemUrl)
            
                var databaseitems = await fetch(getItemUrl)
                const databaseitemsJson = await databaseitems.json()
                console.log(databaseitemsJson)

                if (databaseitems.status === 200){
                    // Get all the databases 
                    
                    var jsondata_obj = databaseitemsJson.data;
                    localStorage.login = jsondata_obj

                    this.name = jsondata_obj['name']
                    this.email = jsondata_obj['email']
                    this.id = localStorage.id
                    
                    if (jsondata_obj['mobile'] == "0" || jsondata_obj['mobile'] == null) {
                        this.mobile = "There is no number yet."
                    }
                    else{
                        this.mobile = jsondata_obj['mobile']
                    }

                    if (jsondata_obj['ratings'] == "0" || jsondata_obj['ratings'] == null) {
                        this.ratings = "There is no ratings yet."
                    }
                    else{
                        this.ratings = jsondata_obj['ratings']
                    }
                    
                    localStorage.login = String(jsondata_obj)

                }
                else{
                    console.log("Database not connected")
                }
            }

          catch(error) {
            console.log(error)
          }
        },
            },
        
        )
        app.component("navbar",{
            template: template1,
            data() {
                return{
                    links: links1,
                    isSignedIn: localStorage.getItem("id"),
                }

            },
            methods:{
                signOut() {
                    let gapi = window.gapi;
                    let clientId ="616186403576-ofsdqf0tp3r19t60rmflus3l3h9p25vo.apps.googleusercontent.com";
                    let apiKey ="AIzaSyC0WtHoYqLnGKgaqLWX6RGkiL0X2C7dll8";
                    let secretClientId = "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";
                    let discoveryDocs =["https://www.googleapis.com/discovery/v1/apis/oauth2/v2/rest"];
                    let scope ="https://www.googleapis.com/auth/userinfo.profile";

                    gapi.load("client:auth2", () => {
                        gapi.client.init({
                            apiKey,
                            clientId,
                            discoveryDocs,
                            scope,
                            secretClientId,})

                            .then(() => {
                                var GoogleAuthObj = gapi.auth2.getAuthInstance();
                                this.GoogleAuth = GoogleAuthObj.signOut();
                                this.isSignedIn = false;
                            })
                    })
                    
                    localStorage.removeItem("login")
                    localStorage.removeItem("id")
                    alert("You have been logged out!")
                    location.reload()
        },
            }
        })
    const vm = app.mount('#app');
</script>
</html>